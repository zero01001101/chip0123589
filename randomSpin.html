<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vòng Quay May Mắn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        
        /* Animation cho con trỏ */
        @keyframes bob {
            0%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            50% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        /* Style cho con trỏ chỉ kết quả */
        .pointer {
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid #ef4444; /* Màu đỏ */
            position: absolute;
            top: -10px; /* Điều chỉnh để đè lên vòng quay */
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            filter: drop-shadow(0 -3px 3px rgba(0,0,0,0.3));
            animation: bob 1.5s ease-in-out infinite;
        }

        /* Custom transition cho popup */
        #popup, #resultPopup, #passwordPopup {
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        #popup-content, #resultPopupContent, #passwordPopupContent {
             transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        /* === HIỆU ỨNG NÚT BẤM MỚI === */
        /* Kiểu dáng chung cho các loại mảnh vỡ */
        .particle {
            position: fixed; /* Dùng fixed để định vị theo viewport */
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            z-index: 100; /* Luôn nổi lên trên cùng */
        }
        
        /* Animation cho mảnh vỡ bay ra */
        .particle.animate {
            animation: particle-explode 1s ease-out forwards;
        }

        @keyframes particle-explode {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--translate-x), var(--translate-y)) scale(0);
                opacity: 0;
            }
        }
        
        /* Hiệu ứng nảy nhẹ cho nút bấm */
        .button-click-effect {
            animation: button-click 0.2s ease-out;
        }

        @keyframes button-click {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        /* === KẾT THÚC HIỆU ỨNG NÚT BẤM === */

    </style>
</head>
<body class="bg-sky-100 flex flex-col items-center justify-center min-h-screen p-4 overflow-hidden">

    <!-- Màn hình loading -->
    <div id="loadingScreen" class="fixed inset-0 bg-sky-100 flex items-center justify-center z-50 transition-opacity duration-500 ease-in-out">
        <h1 class="text-7xl font-bold text-white drop-shadow-lg animate-pulse">zero</h1>
    </div>

    <!-- Popup nhập mật khẩu -->
    <div id="passwordPopup" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 opacity-0 invisible z-40">
        <div id="passwordPopupContent" class="bg-sky-100 rounded-xl shadow-2xl p-6 w-full max-w-sm transform scale-95">
            <h2 class="text-2xl font-bold mb-4 text-gray-800 text-center">Yêu cầu xác thực</h2>
            <p class="text-gray-600 mb-6 text-center">Vui lòng nhập mật khẩu để tiếp tục.</p>
            <input type="password" id="passwordInput" class="w-full px-4 py-3 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 transition text-center">
            <button id="confirmPasswordButton" class="mt-4 w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:ring-opacity-75">
                Xác nhận
            </button>
        </div>
    </div>

    <!-- Nội dung chính của ứng dụng (ẩn ban đầu) -->
    <div id="mainContent" class="invisible opacity-0 transition-opacity duration-500 flex flex-col items-center justify-center w-full">
        <!-- Container chính cho vòng quay và con trỏ -->
        <div class="relative mb-6 flex items-center justify-center">
            <div class="pointer"></div>
            <canvas id="wheelCanvas" width="450" height="450" class="drop-shadow-xl"></canvas>
        </div>

        <!-- Container cho các nút điều khiển -->
        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 w-full max-w-sm">
            <button id="spinButton" class="w-full bg-white hover:bg-gray-200 text-pink-500 font-bold py-2 px-5 text-sm rounded-lg shadow-2xl hover:shadow-inner transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:ring-opacity-75">
                Bắt đầu quay
            </button>
            <button id="addButton" class="w-full bg-white hover:bg-gray-200 text-pink-500 font-bold py-2 px-5 text-sm rounded-lg shadow-2xl hover:shadow-inner transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:ring-opacity-75">
                Nhập thêm
            </button>
        </div>
    </div>


    <!-- Popup để nhập lựa chọn mới -->
    <div id="popup" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 opacity-0 invisible">
        <div id="popup-content" class="bg-sky-100 rounded-xl shadow-2xl p-6 w-full max-w-md transform scale-95">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Thêm lựa chọn mới</h2>
            <input type="text" id="newItemInput" class="w-full px-4 py-3 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
            <button id="confirmAddButton" class="mt-4 w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:ring-opacity-75">
                Xác nhận
            </button>
        </div>
    </div>
    
    <!-- Popup thông báo kết quả (z-index cao hơn) -->
    <div id="resultPopup" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 opacity-0 invisible z-50">
        <div id="resultPopupContent" class="bg-sky-100 rounded-xl shadow-2xl p-8 w-full max-w-sm text-center transform scale-95">
            <p id="resultMessage" class="text-xl font-semibold text-gray-800 mb-6"></p>
            <button id="resultOkButton" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-10 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:ring-opacity-75">
                OK
            </button>
        </div>
    </div>


    <script>
        // Lấy các element
        const loadingScreen = document.getElementById('loadingScreen');
        const passwordPopup = document.getElementById('passwordPopup');
        const passwordPopupContent = document.getElementById('passwordPopupContent');
        const passwordInput = document.getElementById('passwordInput');
        const confirmPasswordButton = document.getElementById('confirmPasswordButton');
        const mainContent = document.getElementById('mainContent');
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spinButton');
        const addButton = document.getElementById('addButton');
        const popup = document.getElementById('popup');
        const popupContent = document.getElementById('popup-content');
        const newItemInput = document.getElementById('newItemInput');
        const confirmAddButton = document.getElementById('confirmAddButton');
        let resultPopup = document.getElementById('resultPopup');
        let resultPopupContent = document.getElementById('resultPopupContent');
        let resultMessage = document.getElementById('resultMessage');
        let resultOkButton = document.getElementById('resultOkButton');
        
        // Cài đặt vòng quay
        let options = [];
        const colors = ['#fbcfe8', '#f9a8d4', '#f472b6', '#ec4899', '#db2777', '#be185d', '#9d174d', '#831843'];
        let startAngle = 0;
        let isSpinning = false;
        let spinTimeout = null;
        let idleAnimation = null;
        let spinAngleStart = 0;
        let spinTime = 0;
        let spinTimeTotal = 0;
        let currentDisplaySize = 450; 

        // === HÀM TẠO HIỆU ỨNG NÚT BẤM ===
        function createParticles(event) {
            const button = event.currentTarget;
            const buttonRect = button.getBoundingClientRect();
            const particleCount = 40;
            const particleColors = ['#fbcfe8', '#f9a8d4', '#f472b6', '#ec4899', '#db2777'];

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                const startX = buttonRect.left + buttonRect.width / 2;
                const startY = buttonRect.top + buttonRect.height / 2;

                particle.style.left = `${startX}px`;
                particle.style.top = `${startY}px`;

                particle.style.backgroundColor = particleColors[Math.floor(Math.random() * particleColors.length)];
                
                const size = Math.random() * 6 + 3;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;

                const angle = Math.random() * 2 * Math.PI;
                const radius = Math.random() * 80 + 50;
                const translateX = `${Math.cos(angle) * radius}px`;
                const translateY = `${Math.sin(angle) * radius}px`;

                particle.style.setProperty('--translate-x', translateX);
                particle.style.setProperty('--translate-y', translateY);
                
                document.body.appendChild(particle);

                setTimeout(() => particle.classList.add('animate'), 10);
                setTimeout(() => particle.remove(), 1000); 
            }

            button.classList.add('button-click-effect');
            setTimeout(() => button.classList.remove('button-click-effect'), 200);
        }

        // Các hàm vẽ và quay
        function getArc() { return options.length > 0 ? (2 * Math.PI / options.length) : 0; }

        function drawBlankWheel() {
            const size = currentDisplaySize;
            const radius = Math.max(0, size / 2 - 10);
            ctx.clearRect(0, 0, size, size);

            ctx.save();
            ctx.translate(size / 2, size / 2);
            ctx.rotate(startAngle);
            ctx.translate(-size / 2, -size / 2);

            ctx.shadowColor = 'rgba(0, 0, 0, 0.25)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 5;

            ctx.beginPath();
            ctx.arc(size / 2, size / 2, radius, 0, 2 * Math.PI, false);
            ctx.fillStyle = '#e5e7eb';
            ctx.fill();
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;

            if (radius > 20) {
                ctx.fillStyle = "#4b5563";
                ctx.font = `bold ${size * 0.05}px "Be Vietnam Pro", sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText("Thêm lựa chọn để bắt đầu", size / 2, size / 2);
            }
            ctx.restore();
        }

        function drawWheel() {
            if (options.length === 0) { drawBlankWheel(); return; }
            const size = currentDisplaySize;
            const arc = getArc();
            const outsideRadius = Math.max(0, size / 2 - 10);
            ctx.clearRect(0, 0, size, size);
            ctx.shadowColor = 'rgba(0, 0, 0, 0.25)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 5;
            for (let i = 0; i < options.length; i++) {
                const angle = startAngle + i * arc;
                ctx.fillStyle = colors[i % colors.length];
                ctx.beginPath();
                ctx.arc(size / 2, size / 2, outsideRadius, angle, angle + arc, false);
                ctx.arc(size / 2, size / 2, 0, angle + arc, angle, true);
                ctx.fill();
            }
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            for (let i = 0; i < options.length; i++) {
                const angle = startAngle + i * arc;
                ctx.beginPath();
                ctx.arc(size / 2, size / 2, outsideRadius, angle, angle + arc, false);
                ctx.arc(size / 2, size / 2, 0, angle + arc, angle, true);
                ctx.stroke();
                if (outsideRadius > 20) {
                    ctx.save();
                    ctx.fillStyle = "white";
                    ctx.font = `bold ${size * 0.04}px "Be Vietnam Pro", sans-serif`;
                    ctx.textAlign = "left";
                    ctx.textBaseline = "middle";
                    ctx.translate(size / 2, size / 2);
                    ctx.rotate(angle + arc / 2);
                    ctx.fillText(options[i], 20, 0);
                    ctx.restore();
                }
            }
        }
        
        function easeOut(t, b, c, d) {
            const ts = (t /= d) * t;
            const tc = ts * t;
            return b + c * (tc + -3 * ts + 3 * t);
        }

        function rotateWheel() {
            spinTime += 30;
            if (spinTime >= spinTimeTotal) { stopRotateWheel(); return; }
            const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
            startAngle += (spinAngle * Math.PI / 180);
            drawWheel();
            spinTimeout = requestAnimationFrame(rotateWheel);
        }

        function stopRotateWheel() {
            cancelAnimationFrame(spinTimeout);
            const arc = getArc();
            const degrees = startAngle * 180 / Math.PI + 90;
            const arcd = arc * 180 / Math.PI;
            const index = Math.floor((360 - degrees % 360) / arcd);
            showResultPopup(`Kết quả: ${options[index]}`);
            isSpinning = false;
            idleAnimate();
        }
        
        function idleAnimate() {
            if (!isSpinning) {
                startAngle += 0.001;
                drawWheel();
                idleAnimation = requestAnimationFrame(idleAnimate);
            }
        }
        
        function handleResize() {
            const sizeFromWidth = window.innerWidth * 0.9;
            const sizeFromHeight = window.innerHeight * 0.65;
            const minSize = 200;
            const maxSize = 700; 
            const baseSize = Math.max(minSize, Math.min(sizeFromWidth, sizeFromHeight, maxSize));
            const ratio = (window.devicePixelRatio || 1) * 3;
            currentDisplaySize = baseSize;
            canvas.width = baseSize * ratio;
            canvas.height = baseSize * ratio;
            canvas.style.width = baseSize + 'px';
            canvas.style.height = baseSize + 'px';
            ctx.scale(ratio, ratio);
            drawWheel();
        }

        // Các hàm xử lý popup
        function showResultPopup(message) {
            resultMessage.textContent = message;
            resultPopup.classList.remove('invisible', 'opacity-0');
            resultPopupContent.classList.remove('scale-95');
            resultOkButton.onclick = (event) => {
                createParticles(event);
                closeResultPopup();
            };
            resultPopup.onclick = (event) => { if (event.target === resultPopup) closeResultPopup(); };
        }

        function closeResultPopup() {
            resultPopupContent.classList.add('scale-95');
            resultPopup.classList.add('opacity-0');
            setTimeout(() => { resultPopup.classList.add('invisible'); }, 300); 
        }

        function closeInputPopup() {
             popup.classList.add('opacity-0');
             popupContent.classList.add('scale-95');
             setTimeout(() => { popup.classList.add('invisible'); }, 300);
        }

        // Event listeners cho các nút chính
        spinButton.addEventListener('click', (event) => {
            createParticles(event);
            if (isSpinning) return;
            if (options.length < 2) { showResultPopup("Vui lòng thêm ít nhất 2 lựa chọn!"); return; }
            cancelAnimationFrame(idleAnimation);
            isSpinning = true;
            spinAngleStart = Math.random() * 10 + 10;
            spinTime = 0;
            spinTimeTotal = Math.random() * 3000 + 5000;
            rotateWheel();
        });

        addButton.addEventListener('click', (event) => {
            createParticles(event);
            popup.classList.remove('invisible', 'opacity-0');
            popupContent.classList.remove('scale-95');
            newItemInput.focus();
        });
        
        confirmAddButton.addEventListener('click', (event) => {
            createParticles(event);
            const newValue = newItemInput.value.trim();
            if (newValue) {
                options.push(newValue);
                newItemInput.value = '';
                drawWheel();
                closeInputPopup();
            }
        });
        
        newItemInput.addEventListener('keyup', (event) => { if (event.key === 'Enter') confirmAddButton.click(); });
        popup.addEventListener('click', (event) => { if (event.target === popup) closeInputPopup(); });
        window.addEventListener('resize', handleResize);

        // ===============================================
        // == LOGIC KHỞI ĐỘNG VÀ XÁC THỰC MẬT KHẨU ==
        // ===============================================
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Hiển thị màn hình loading
            setTimeout(() => {
                loadingScreen.classList.add('opacity-0');
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    
                    // 2. Hiển thị popup mật khẩu
                    passwordPopup.classList.remove('invisible', 'opacity-0');
                    passwordPopupContent.classList.remove('scale-95');
                    passwordInput.focus();

                }, 500);
            }, 2000);

            // 3. Logic kiểm tra mật khẩu
            const checkPassword = (event) => {
                createParticles(event);
                const pass = passwordInput.value;
                if (pass === '23090508') {
                    passwordPopupContent.classList.add('scale-95');
                    passwordPopup.classList.add('opacity-0');
                    setTimeout(() => {
                        passwordPopup.style.display = 'none';

                        // Hiển thị ứng dụng chính
                        mainContent.classList.remove('invisible', 'opacity-0');
                        handleResize();
                        idleAnimate();

                    }, 300);
                } else {
                    setTimeout(() => { // Delay nhỏ để hiệu ứng nổ kết thúc
                        showResultPopup('Mật khẩu sai, vui lòng nhập lại!');
                        passwordInput.value = '';
                        passwordInput.focus();
                    }, 200);
                }
            };

            confirmPasswordButton.addEventListener('click', checkPassword);
            passwordInput.addEventListener('keyup', (event) => { if (event.key === 'Enter') confirmPasswordButton.click(); });
        });
    </script>
</body>
</html>

